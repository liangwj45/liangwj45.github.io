<!DOCTYPE html><html lang="zn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="keywords" content="Wenjie Liang, 奥小文的加油站"><meta name="description"><title>Ex2：用 CImg 重写 Canny 代码</title><link rel="icon" href="/images/avatar.jpg?v=1.5.4" type="image/png" sizes="16x16"><link rel="icon" href="/images/avatar.jpg?v=1.5.4" type="image/png" sizes="32x32"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=1.5.4"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontawesome: {"prefix":"fa"},
  sidebar: {"offsetTop":"30px","renderTocDepth":4},
  header: {"scrollDownIcon":false},
  back2top: {"enable":true},
  reward: false,
  fancybox: false,
  zoom_image: {"enable":true,"mask_color":"rgba(0,0,0,0.6)"},
  gallery_waterfall: undefined,
  lazyload: undefined,
  pjax: undefined,
  external_link: {"icon":{"enable":true,"name":"external-link"}},
  shortcuts: {"switch_post":false},
  prompt: {"copy_success":"Copy Success","copy_error":"Copy Error","creative_commons":"Creative Commons","copy_button":"Click to Copy"}
};

window.CONFIG = CONFIG;</script></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav"><div class="header-nav-inner"><div class="header-nav-btn fa fa-bars"></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__a" href="/"><i class="fa fa-home"></i>Home</a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__a" href="/archives/"><i class="fa fa-folder-open"></i>Archives</a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__a" href="/categories/"><i class="fa fa-th"></i>Categories</a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__a" href="/tags/"><i class="fa fa-tags"></i>Tags</a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__a" href="/about/"><i class="fa fa-user"></i>About</a></div></div></div></nav><div class="header-info"><div class="header-info-inner"><div class="header-info-title">奥小文的加油站</div><div class="header-info-subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content"><div class="post"><header class="post-header"><h1 class="post-header-title">Ex2：用 CImg 重写 Canny 代码</h1><div class="post-header-meta"><span class="post-header-meta-create"><i class="fa fa-calendar-o"></i><span>Posted </span><span>2019-10-10</span></span><span class="post-header-meta-reading-count"><i class="fa fa-eye"></i><span>Visited </span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><h2 id="编写头文件"><span class="heading-link">编写头文件</span></h2>
<p>模仿 <code>canny_source.c</code> 写出 Canny 边缘检测算法需要用到的方法，并将源代码中各个方法中的参数改写成 C++ 类中的成员变量，最后补上构造和析构函数。</p>
<a id="more"></a>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CImg.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cimg_library;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Canny</span> &#123;</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img;</span><br><span class="line">  <span class="built_in">string</span> img_name;     <span class="comment">// The name of the image.</span></span><br><span class="line">  <span class="keyword">int</span> rows;            <span class="comment">// The height of the image.</span></span><br><span class="line">  <span class="keyword">int</span> cols;            <span class="comment">// The width of the image.</span></span><br><span class="line">  <span class="keyword">int</span>* delta_x;        <span class="comment">// The first devivative image, x-direction.</span></span><br><span class="line">  <span class="keyword">int</span>* delta_y;        <span class="comment">// The first derivative image, y-direction.</span></span><br><span class="line">  <span class="keyword">float</span>* dir_radians;  <span class="comment">// Gradient direction image.</span></span><br><span class="line">  <span class="keyword">int</span>* magnitude;      <span class="comment">// The magnitude of the gadient image.</span></span><br><span class="line">  <span class="keyword">int</span>* smoothedim;     <span class="comment">// The image after gaussian smoothing.</span></span><br><span class="line">  <span class="keyword">int</span>* nms;            <span class="comment">// The image after non-maximize suppression.</span></span><br><span class="line">  <span class="keyword">int</span>* edge;           <span class="comment">// The image after hysterresis.</span></span><br><span class="line">  <span class="keyword">int</span>* lconnect;       <span class="comment">// The image after connecting line.</span></span><br><span class="line">  <span class="keyword">int</span>* ldelete;        <span class="comment">// The image after deleting line.</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  Canny(<span class="built_in">string</span> img_name);</span><br><span class="line">  ~Canny();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">canny_edge_detection</span><span class="params">(<span class="keyword">float</span> sigma, <span class="keyword">float</span> tlow, <span class="keyword">float</span> thig, <span class="keyword">int</span> distance)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">save_result</span><span class="params">(<span class="built_in">string</span> tag)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RGB2Gray</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">gaussian_smooth</span><span class="params">(<span class="keyword">float</span> sigma)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">make_gaussian_kernel</span><span class="params">(<span class="keyword">float</span> sigma, <span class="keyword">float</span>** kernel, <span class="keyword">int</span>* windowsize)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">derrivative_x_y</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">magnitude_x_y</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">radian_direction</span><span class="params">(<span class="keyword">int</span> xdirtag, <span class="keyword">int</span> ydirtag)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">angle_radians</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">non_max_supp</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">apply_hysteresis</span><span class="params">(<span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">follow_edges</span><span class="params">(<span class="keyword">int</span>* edgemapptr, <span class="keyword">int</span>* edgemagptr, <span class="keyword">int</span> lowval, <span class="keyword">int</span> cols)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">connect_line</span><span class="params">(<span class="keyword">int</span> distance)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">delete_line</span><span class="params">(<span class="keyword">int</span> distance)</span></span>;</span><br><span class="line"></span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; matrix2image(<span class="keyword">int</span>* matrix);</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">image2matrix</span><span class="params">(CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img, <span class="keyword">int</span>* matrix)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>
<h2 id="编写源文件"><span class="heading-link">编写源文件</span></h2>
<p>主要编写构造和析构函数，以及连接删除边和保存图片相关的代码，其他部分代码与 <code>canny_source.c</code> 中的基本相同，由于篇幅过大，那部分代码就不放出来了。</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"canny.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M_PI 3.14159265358979323846</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOSTBLURFACTOR 90.0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NOEDGE 255</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POSSIBLE_EDGE 128</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EDGE 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMGPATH <span class="meta-string">"/img/ComputerVision/Ex2/"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cimg_library;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> black[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">Canny::Canny(<span class="built_in">string</span> img_name) : img_name(img_name) &#123;</span><br><span class="line">  img = CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt;(<span class="built_in">string</span>(IMGPATH + img_name).c_str());</span><br><span class="line">  rows = img.height();</span><br><span class="line">  cols = img.width();</span><br><span class="line"></span><br><span class="line">  delta_x = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  delta_y = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  dir_radians = <span class="keyword">new</span> <span class="keyword">float</span>[rows * cols];</span><br><span class="line">  magnitude = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  smoothedim = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  nms = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  edge = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  lconnect = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line">  ldelete = <span class="keyword">new</span> <span class="keyword">int</span>[rows * cols];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(delta_x, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(delta_y, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(dir_radians, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">  <span class="built_in">memset</span>(magnitude, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(smoothedim, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(nms, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(edge, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(lconnect, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">  <span class="built_in">memset</span>(ldelete, <span class="number">0</span>, rows * cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Canny::~Canny() &#123;</span><br><span class="line">  <span class="keyword">delete</span>[] delta_x;</span><br><span class="line">  <span class="keyword">delete</span>[] delta_y;</span><br><span class="line">  <span class="keyword">delete</span>[] dir_radians;</span><br><span class="line">  <span class="keyword">delete</span>[] magnitude;</span><br><span class="line">  <span class="keyword">delete</span>[] nms;</span><br><span class="line">  <span class="keyword">delete</span>[] edge;</span><br><span class="line">  <span class="keyword">delete</span>[] lconnect;</span><br><span class="line">  <span class="keyword">delete</span>[] ldelete;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::canny_edge_detection(<span class="keyword">float</span> sigma, <span class="keyword">float</span> tlow, <span class="keyword">float</span> thig,</span><br><span class="line">                                 <span class="keyword">int</span> distance) &#123;</span><br><span class="line">  RGB2Gray();</span><br><span class="line">  gaussian_smooth(sigma);</span><br><span class="line">  derrivative_x_y();</span><br><span class="line">  magnitude_x_y();</span><br><span class="line">  radian_direction(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">  non_max_supp();</span><br><span class="line">  apply_hysteresis(tlow, thig);</span><br><span class="line"></span><br><span class="line">  connect_line(distance);</span><br><span class="line">  delete_line(distance);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::connect_line(<span class="keyword">int</span> distance) &#123;</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img = matrix2image(edge);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> isEdge[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line">  <span class="keyword">int</span> dx[<span class="number">8</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;, dy[<span class="number">8</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line"></span><br><span class="line">  cimg_forXY(img, x, y) &#123;</span><br><span class="line">    isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; img(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> neighbors[<span class="number">8</span>], m = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> di = x + dx[i], dj = y + dy[i];</span><br><span class="line">        <span class="keyword">if</span> (di != x || dj != y) neighbors[m] = img(di, dj), m++;</span><br><span class="line">      &#125;</span><br><span class="line">      sort(neighbors, neighbors + <span class="number">8</span>);</span><br><span class="line">      isEdge[x][y] = (neighbors[<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; neighbors[<span class="number">1</span>] == <span class="number">255</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cimg_forXY(img, x, y) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= distance &amp;&amp; x &lt;= rows - <span class="number">1</span> - distance &amp;&amp; y &gt;= distance &amp;&amp;</span><br><span class="line">        y &lt;= cols - <span class="number">1</span> - distance &amp;&amp; isEdge[x][y] == <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = x - distance; i &lt;= x + distance; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = y - distance; j &lt;= y + distance; j++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isEdge[i][j] == <span class="literal">true</span>) &#123;</span><br><span class="line">            img.draw_line(x, y, i, j, black);</span><br><span class="line">            isEdge[i][j] = <span class="literal">false</span>, isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  image2matrix(img, lconnect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::delete_line(<span class="keyword">int</span> distance) &#123;</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img = matrix2image(lconnect);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> isEdge[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line">  <span class="keyword">int</span> dx[<span class="number">8</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;, dy[<span class="number">8</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line"></span><br><span class="line">  cimg_forXY(img, x, y) &#123;</span><br><span class="line">    isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; img(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> neighbors[<span class="number">8</span>], m = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> di = x + dx[i], dj = y + dy[i];</span><br><span class="line">        <span class="keyword">if</span> (!(di == x &amp;&amp; dj == y)) &#123;</span><br><span class="line">          neighbors[m] = img(di, dj), m++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      sort(neighbors, neighbors + <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">if</span> (neighbors[<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; neighbors[<span class="number">1</span>] == <span class="number">255</span>) isEdge[x][y] = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">if</span> (neighbors[<span class="number">0</span>] == <span class="number">255</span>) img(x, y) = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cimg_forXY(img, x, y) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isEdge[x][y] == <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> beg_x = x - distance &gt; <span class="number">0</span> ? x - distance : <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> beg_y = y - distance &gt; <span class="number">0</span> ? y - distance : <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> end_x = x + distance &lt; rows - <span class="number">1</span> ? x + distance : rows - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> end_y = y + distance &lt; cols - <span class="number">1</span> ? y + distance : cols - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = beg_x; i &lt;= end_x; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = beg_y; j &lt;= end_y; j++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isEdge[i][j]) &#123;</span><br><span class="line">            <span class="keyword">int</span> max_x = x &gt;= i ? x : i;</span><br><span class="line">            <span class="keyword">int</span> max_y = y &gt;= j ? y : j;</span><br><span class="line">            <span class="keyword">int</span> min_x = max_x == x ? i : x;</span><br><span class="line">            <span class="keyword">int</span> min_y = max_y == y ? j : y;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> ii = min_x; ii &lt;= max_x; ii++) &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> jj = min_y; jj &lt;= max_y; jj++) &#123;</span><br><span class="line">                img(ii, jj) = <span class="number">255</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            isEdge[i][j] = <span class="literal">false</span>, isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cimg_forXY(img, x, y) &#123;</span><br><span class="line">    isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; img(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> neighbors[<span class="number">8</span>], m = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> di = x + dx[i], dj = y + dy[i];</span><br><span class="line">        <span class="keyword">if</span> (!(di == x &amp;&amp; dj == y)) neighbors[m] = img(di, dj), m++;</span><br><span class="line">      &#125;</span><br><span class="line">      sort(neighbors, neighbors + <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">if</span> (neighbors[<span class="number">0</span>] == <span class="number">255</span>) img(x, y) = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  image2matrix(img, ldelete);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::save_result(<span class="built_in">string</span> tag) &#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">""</span> + <span class="keyword">this</span>-&gt;img_name).c_str() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  img.save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"00-"</span> + <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">  matrix2image(smoothedim).save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"01-guassian-"</span>+ <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">  matrix2image(nms).save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"02-nms-"</span>+ <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">  matrix2image(edge).save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"03-edge-"</span> + <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">  matrix2image(lconnect).save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"04-connect-"</span>+ <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">  matrix2image(ldelete).save(<span class="built_in">string</span>(<span class="string">"./result/"</span> + tag + <span class="string">"05-delete-"</span>+ <span class="keyword">this</span>-&gt;img_name).c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; Canny::matrix2image(<span class="keyword">int</span>* matrix) &#123;</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img(rows, cols, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">  img.fill(<span class="number">0</span>);</span><br><span class="line">  cimg_forXY(img, x, y) &#123; img(x, y, <span class="number">0</span>) = matrix[x * cols + y]; &#125;</span><br><span class="line">  <span class="keyword">return</span> img;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::image2matrix(CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; img, <span class="keyword">int</span>* matrix) &#123;</span><br><span class="line">  cimg_forXY(img, x, y) &#123; matrix[x * cols + y] = img(x, y, <span class="number">0</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<h2 id="编写测试代码"><span class="heading-link">编写测试代码</span></h2>
<p>编写一个 <code>main.cpp</code> 用于测试。</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"canny.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">list</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">stringstream</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  Test(Canny&amp; img) : img(img) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">float</span> sigma, <span class="keyword">float</span> tlow, <span class="keyword">float</span> thig, <span class="keyword">int</span> distance)</span> </span>&#123;</span><br><span class="line">    img.canny_edge_detection(sigma, tlow, thig, distance);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="built_in">string</span> tag)</span> </span>&#123; img.save_result(tag); &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  Canny&amp; img;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">list</span>&lt;<span class="built_in">string</span>&gt; images(&#123;<span class="string">"3.bmp"</span>, <span class="string">"4.bmp"</span>, <span class="string">"20160326110137505.bmp"</span>, <span class="string">"bigben.bmp"</span>,</span><br><span class="line">                       <span class="string">"lena.bmp"</span>, <span class="string">"stpietro.bmp"</span>&#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> it = images.begin(); it != images.end(); ++it) &#123;</span><br><span class="line">    <span class="function">Canny <span class="title">img</span><span class="params">(*it)</span></span>;</span><br><span class="line">    <span class="function">Test <span class="title">test</span><span class="params">(img)</span></span>;</span><br><span class="line">    test.test(<span class="number">1.5</span>, <span class="number">0.3</span>, <span class="number">0.75</span>, <span class="number">10</span>);</span><br><span class="line">    test.save(<span class="string">""</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>上述代码中四个参数</p>
<ul>
<li><code>float sigma</code>：1.5</li>
<li><code>float tlow</code>：0.3</li>
<li><code>float thig</code>：0.75</li>
<li><code>int distance</code>：10</li>
</ul>
<p>的值是经过多次调参得出的，调参过程的结果可以在 <code>code/result/</code> 目录中查看。</p>
<h2 id="删除短边的优缺点"><span class="heading-link">删除短边的优缺点</span></h2>
<p>删除短边可以去掉一些离散的边缘，减少噪声，但可能会误删真实存在的短边。</p>
<h2 id="各参数对结果的影响"><span class="heading-link">各参数对结果的影响</span></h2>
<ul>
<li>
<p><code>sigma</code> ：Standard deviation of the gaussian kernel.</p>
<blockquote>
<p>标准差减小时，会增加噪声；标准差增大时，原来的强边缘像素大部分被误认为噪声，会造成边缘缺失。</p>
</blockquote>
</li>
<li>
<p><code>tlow</code> ：Fraction of the high threshold in hysteresis.</p>
<blockquote>
<p>低阈值减小时，会增加噪声；低阈值增大时，会丢失强边缘像素。</p>
</blockquote>
</li>
<li>
<p><code>thig</code> ：High hysteresis threshold control. The actual is the (100 * thigh) percentage point the histogram of the magnitude of the image that passes non-maximal.</p>
<blockquote>
<p>高阈值减小时，会增加强边缘像素；高阈值增大时，强边缘像素部分会转化为弱边缘像素，丢失部分边缘像素点。</p>
</blockquote>
</li>
</ul>
<h2 id="程序运行结果"><span class="heading-link">程序运行结果</span></h2>
<p><img src="/img/ComputerVision/Ex2/3.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/3-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/4.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/4-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/20160326110137505.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/20160326110137505-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/bigben.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/bigben-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/lena.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/lena-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/stpietro.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/stpietro-result.bmp" alt></p>
<p><img src="/img/ComputerVision/Ex2/1.png" alt></p>
<p><img src="/img/ComputerVision/Ex2/2.png" alt></p>
<p><img src="/img/ComputerVision/Ex2/3.png" alt></p>
<p><img src="/img/ComputerVision/Ex2/4.png" alt></p>
<p><img src="/img/ComputerVision/Ex2/5.png" alt></p>
<p><img src="/img/ComputerVision/Ex2/6.png" alt></p>
<h2 id="总结"><span class="heading-link">总结</span></h2>
<p>图像经过灰度处理，高斯滤波去噪，应用非极大值压制以及双阈值检测得到的边缘检测结果还算是比较理想，最后加上自己编写的合并相邻的线条和删除短线条，即使通过调参，都没有太明显的效果。</p>
</div><footer class="post-footer"><div class="post-end"><span>------ </span><span>End of text, thank you for reading</span><span> ------</span></div><div class="post-tags"><span class="post-tags-item"><i class="post-tags-item__i fa fa-tags"></i><a class="post-tags-item__a" href="liangwj45.github.io/tags/Canny-边缘检测算法/">Canny 边缘检测算法</a></span></div><nav class="paginator"><div class="paginator-post"><div class="paginator-post-prev"><a class="paginator-post-prev__a" href="/2019/10/10/Ex1：图像读取和显示以及像素操作/"><i class="fa fa-chevron-left"></i><span>Ex1：图像读取和显示以及像素操作</span></a></div></div></nav></footer></div></div></div><aside class="sidebar" id="sidebar"><div class="sidebar-inner"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编写头文件"><span class="toc-number">1.</span> <span class="toc-text">编写头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写源文件"><span class="toc-number">2.</span> <span class="toc-text">编写源文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写测试代码"><span class="toc-number">3.</span> <span class="toc-text">编写测试代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除短边的优缺点"><span class="toc-number">4.</span> <span class="toc-text">删除短边的优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#各参数对结果的影响"><span class="toc-number">5.</span> <span class="toc-text">各参数对结果的影响</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序运行结果"><span class="toc-number">6.</span> <span class="toc-text">程序运行结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol></div></section><!-- ov = overview --><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/avatar.jpg" alt="avatar"></div><p class="sidebar-ov-author__p">你今天吃早餐了吗？</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social__item" href="https://github.com/liangwj45" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><i class="sidebar-ov-social__item--icon fa fa-github"></i></a><a class="sidebar-ov-social__item" href="liangwj45@mail2.syu.edu.cn" target="_blank" rel="noopener" data-popover="Email" data-popover-pos="up"><i class="sidebar-ov-social__item--icon fa fa-envelope-o"></i></a><a class="sidebar-ov-social__item" href="290095633" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><i class="sidebar-ov-social__item--icon fa fa-qq"></i></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state__a posts" href="/archives/"><div class="sidebar-ov-state__a--count">16</div><div class="sidebar-ov-state__a--name">Archives</div></a><a class="sidebar-ov-state__a categories" href="/categories/"><div class="sidebar-ov-state__a--count">3</div><div class="sidebar-ov-state__a--name">Categories</div></a><a class="sidebar-ov-state__a tags" href="/tags/"><div class="sidebar-ov-state__a--count">16</div><div class="sidebar-ov-state__a--name">Tags</div></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span>You have read </span><span class="sidebar-reading-info-num">0</span></div><div class="sidebar-reading-line"></div></div></div></aside><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>&copy; 2019</span><span> </span><span>Wenjie Liang.</span></div><div><span>Powered by <a href="http://hexo.io/" title="hexo" target="_blank" rel="noopener">hexo</a></span><span class="separator">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="stun" target="_blank" rel="noopener">stun</a></span></div><div class="busuanzi"><span class="busuanzi-site_pv"><i class="fa fa-eye"></i><span>Views </span><span id="busuanzi_value_site_pv"></span></span><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script></div></div></footer><div class="loading-bar" id="loading-bar"><div class="progress"></div></div><div class="back2top" id="back2top"><i class="back2top-icon fa fa-rocket"></i></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=1.5.4"></script><script src="/js/stun-boot.js?v=1.5.4"></script><script src="/js/scroll.js?v=1.5.4"></script><script src="/js/header.js?v=1.5.4"></script><script src="/js/sidebar.js?v=1.5.4"></script></body></html>